<html lang="en">
	<head>
    <meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="gen/main.js"></script>
    <script>
      const controller = {};

      const config = {
        showDebugInfo: true,
        glConfig: {
          backgroundColor: { r:0, g:0.1, b:0, a:1 },
        },
        activeProgram: "sample-multicolor",
        programs: [
          {
              id: "sample-multicolor",
              shaderConfig: {
                vertex: 
                `#version 300 es

                  precision highp float;
                  in vec4 position;
                  in vec3 color;
                  
                  out vec3 vColor;

                  void main() {
                      vColor = color;
                      gl_Position = position;
                  }
                `,
                fragment:
                `#version 300 es

                  precision highp float;
                  in vec3 vColor;
                  out vec4 fragColor;

                  void main() {
                      fragColor = vec4(vColor, 1.0);
                  }
                `
              },
              attributeConfigs: [
                {
                  name: "position",
                  location: 0,
                  type: "FLOAT",
                  usage: "STATIC_DRAW",
                },
                {
                  name: "color",
                  type: "FLOAT",
                  usage: "STATIC_DRAW",
                }
              ],
          },
          {
              id: "sample-red",
              shaderConfig: {
                vertex: 
                `#version 300 es

                  precision highp float;
                  in vec4 position;

                  void main() {
                      gl_Position = position;
                  }
                `,
                fragment:
                `#version 300 es

                  precision highp float;
                  out vec4 fragColor;

                  void main() {
                      fragColor = vec4(0.5, 0.0, 0.0, 1.0);
                  }
                `
              },
              attributeConfigs: [
                {
                  name: "position",
                  location: 0,
                  type: "FLOAT",
                  usage: "STATIC_DRAW",
                }
              ],
          },
          {
              id: "sample-blue",
              shaderConfig: {
                vertex: 
                `#version 300 es

                  precision highp float;
                  in vec4 position;

                  void main() {
                      gl_Position = position;
                  }
                `,
                fragment:
                `#version 300 es

                  precision highp float;
                  out vec4 fragColor;

                  void main() {
                      fragColor = vec4(0.0, 0.0, 0.5, 1.0);
                  }
                `
              },
              attributeConfigs: [
                {
                  name: "position",
                  location: 0,
                  type: "FLOAT",
                  usage: "STATIC_DRAW",
                }
              ],
          }        
        ],
        onRefresh(gl) {
          const triangleArray = gl.createVertexArray();
          gl.bindVertexArray(triangleArray);

          var positions = new Float32Array([
              -0.5, -0.5, 0.0,
              0.5, -0.5, 0.0,
              0.0, 0.5, 0.0
          ]);

          const positionBuffer = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
          gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);
          gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);
          gl.enableVertexAttribArray(0);

          const colors = new Float32Array([
              1.0, 0.0, 0.0,
              0.0, 1.0, 0.0,
              0.0, 0.0, 1.0
          ]);

          const colorBuffer = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
          gl.bufferData(gl.ARRAY_BUFFER, colors, gl.STATIC_DRAW);
          gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 0, 0);
          gl.enableVertexAttribArray(1);

          ////////////////
          // DRAW
          ////////////////
          gl.clear(gl.COLOR_BUFFER_BIT);
          gl.drawArrays(gl.TRIANGLES, 0, 3);
        }
      };

      document.addEventListener("DOMContentLoaded", () => {
        const div = document.createElement("div");
        div.style.border = "2px solid red";
        document.body.appendChild(div);
        exports.hookupCanvas(div, config, controller);
      });
    </script>
    <title>Demo</title>
	</head>
	<body>
    <div style="display: flex; flex-direction: row; position: absolute; color: whitesmoke">
      <div>
        <label for="active">Active</label>
        <input id="active" type="checkbox" onChange="controller?.setActive(this.checked)" checked>    
      </div>
      <div>
        <label for="program">Program</label>
        <select id="program" onchange="controller?.setActiveProgram(this.value)">
          <option value="sample-multicolor" selected>Sample Multicolor</option>
          <option value="sample-red">Sample Red</option>
          <option value="sample-blue">Sample Blue</option>
        </select>
      </div>
    </div>



    <div id="root"></div>
	</body>
</html>
